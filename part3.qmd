# Part 3: Methods

Mathematically, it can be written as:

$$
h(t) = h_0(t) * e^{b_1x_1 + b_2x_2 + … + b_px_p}
$$

In words, it can be stated that the hazard function, $h(t)$, is determined by the baseline hazard ($h_0(t)$), a set of variables ($x_1, x_2, … x_p$), and the effect of each variable is determined by their coefficient ($b_1, b_2 … b_p$) (11). This method does not make the assumption that survival times follow any type of statistical distribution. In the development of the model, it is important to consider whether colinearity, the correlation between two of the independent variables, exists (14). 

***Add in the following:***

+ **Proportionality assumption & hazard ratios - define & explain**

+ **Explain the baseline hazard 'intercept' term, and multiplicative interaction with covariates.**





*********************************************************************


```{r, echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)
library(haven)
library(table1)
library(lubridate)
library(survival)
library(ggsurvfit)
library(gtsummary)

#library(tidycmprsk)
#library(condSURV)
```

```{r, echo = FALSE, warning = FALSE, message = FALSE}

#load visit 1 data
datav1 <- read_dta("data/analysis1.dta")
visit1 <- datav1 %>% dplyr :: select(subjid, visitdate, age, htn, diab3cat, idealhealthsmk, bmi3cat, totchol3cat)

#visit1 <- visit1 %>% rename(visitdate_v1 = visitdate)

#load adjudicated data

#data_allevtstroke <- read_sas("data/allevtstroke.sas7bdat", NULL)
#allevtstroke <- data_allevtstroke %>% dplyr :: select(subjid, Stroke, OHDStroke, eventdate)

data_incevtstroke <- read_sas("data/incevtstroke.sas7bdat", NULL)
incevtstroke <- data_incevtstroke %>% dplyr :: select(subjid, stroke, date, contactType)

#allevtstroke <- allevtstroke %>% rename(stroke_allevt = Stroke, ohdstroke = OHDStroke)

incevtstroke <- incevtstroke %>% rename(contacttype = contactType)

#data_adj <- full_join(allevtstroke, incevtstroke, by = "subjid")

# Create final data set

data <- full_join(incevtstroke, visit1, by = "subjid")
data <- na.omit(data)

```

```{r, echo = FALSE, warning = FALSE, message = FALSE}

#Create time variable (time from visit 1 until event/censoring date)
data <- data %>% mutate(time = difftime(date, visitdate))

#Create the survival object (created from time variable and if the event has taken place.)
obj <- Surv(data$time, data$stroke)
```
```{r}
 #Sample from object vector
 tail(head(obj, 115), 5)
```


## K-M Plot

Data reported by the JHS study was used in calculating basic survival analysis on the adjudication of strokes in the cohort. Two data sets were utilized and joined on the variable subjectid. After removing N/As, 2,288 observations remained in the data set for further analysis. The analysis was completed using R statistical software package, specifically the {survival} package. A time variable was created from the date at visit 1 until either the date of event (stroke) or the censoring date to use in the analysis. Using the calculated time and the variable stroke, a survival object was created using the surv function. The object created was then used  to construct a survival curve using the survfit function. A Kaplan-Meier plot was then created to visualize the survival curve and confidence interval with the x-axis representing time and the y-axis representing the probability of being stroke free. 


## Cox Proportion Hazards Model

Finally, the Cox PH analysis was used to model multiple variables from the data set. The coxph() function from the {survival} package was used. The object previously created for the KM plot is used on the left side with standard regression formulas on the right. All variables considered in the model are identified by the CDC as major risk factors for stroke. A table of results was created using the tbl_regression() function out of {gtsummary}, with exponentiate set to TRUE to return the hazard ratio versus the log hazard ratio.

## Assumption Verification




