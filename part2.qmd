# Part 2: Data Exploration 

```{r, echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)
library(haven)
library(table1)
library(lubridate)
library(survival)
library(ggsurvfit)
library(gtsummary)

#library(tidycmprsk)
#library(condSURV)
```


## Data Dictionary

Two data sets were utilized and joined to create a final data set for analysis. Following are the variables used.

### **DATA SET:** analysis1 {.unnumbered}

These data include observations from the participant's first visit in the study.

SUBJID

:   Subject identification number for participant

VISITDATE

:   Date of participant exam visit

AGE

:   Age (in years) of participant at time of visit 1
:   Age, based on birth date and clinic visit date, rounded to 0.1

HTN

:   Hypertension Status
:   HTN status is defined as blood pressure $\geq$ 140/90 mmHg (per JNC 7) or  use of blood pressure lowering medication.
:   0 = if BPjnc7 $\leq$ 1 (Normal/Pre-Hypertensive) AND participant NOT on medication
:   1 = if BPjnc7 $\geq$ 2 (Stage I/II Hypertension) AND participant uses medication to control hypertension

DIAB3CAT

:   Diabetes categorization

:   0 = Non-diabetic

:   1 = Pre-Diabetic

:   2 = Diabetic

IDEALHEALTHSMK

:   Indicator for Ideal Health via Smoking Status

:   0 = Current smoker or Quit < 12 months ago

:   1 = Never smoked or Quit $\geq$ 12 months ago

BMI3CAT

:   0 = Poor Health defined as BMI $\geq$ 30 (obese)

:   1 = Intermediate Health defined as 25 $\leq$ BMI < 30 (Overweight)

:   2 = Ideal Health defined as BMI < 25 (Normal)

TOTCHOL3CAT

:   AHA Total Cholesterol Categorization

:   0 = Poor Health defined as Total Cholesterol $\geq$ 240

:   1 = Intermediate Health defined as 200 $\leq$ Total Cholesterol < 240 OR if Total Cholesterol < 200 as controlled by medication

:   2 = Ideal Health defined as Total Cholesterol < 200 with NO medication use


### **DATA SET:** incevtstroke {.unnumbered}

SUBJID

:   Subject identification number for participant

STROKE
:   0 = No stroke
:   1 = Adjudication of Stroke

V1DATE

:   Date of Exam 1 Clinic Visit

DATE

:   Event (stroke) or Censoring Date

CONTACTTYPE

:   Last Contact Type (Censored, Hemorrhagic Stroke, Ischemic Stroke, Previous Stroke, Previous Stroke History, Refused)

## Summary statistics

```{r, echo = FALSE, warning = FALSE, message = FALSE}

#load visit 1 data
datav1 <- read_dta("data/analysis1.dta")
visit1 <- datav1 %>% dplyr :: select(subjid, visitdate, age, htn, diab3cat, idealhealthsmk, bmi3cat, totchol3cat)

#visit1 <- visit1 %>% rename(visitdate_v1 = visitdate)

#load adjudicated data

#data_allevtstroke <- read_sas("data/allevtstroke.sas7bdat", NULL)
#allevtstroke <- data_allevtstroke %>% dplyr :: select(subjid, Stroke, OHDStroke, eventdate)

data_incevtstroke <- read_sas("data/incevtstroke.sas7bdat", NULL)
incevtstroke <- data_incevtstroke %>% dplyr :: select(subjid, stroke, date, contactType)

#allevtstroke <- allevtstroke %>% rename(stroke_allevt = Stroke, ohdstroke = OHDStroke)

incevtstroke <- incevtstroke %>% rename(contacttype = contactType)

#data_adj <- full_join(allevtstroke, incevtstroke, by = "subjid")

# Create final data set

data <- full_join(incevtstroke, visit1, by = "subjid")
data <- na.omit(data)

###Example Code
# v1$hsgrad <- as.factor(v1$hsgrad)
# v1$bmi3cat <- as.factor(v1$bmi3cat)
# v1$htn <- as.factor(v1$htn)
# 
# label(v1$hsgrad) <- "High School Graduate"
# label(v1$bmi3cat) <- "AHA BMI Categorization"
# label(v1$htn) <- "Hypertension Status"
# 
# levels(v1$hsgrad) <- c("Nongraduate", "Graduate")
# levels(v1$bmi3cat) <- c("Poor", "Intermediate", "Ideal")
# levels(v1$htn) <- c("Normotensive", "Hypertensive")
# 
# table1(~ htn + age + totchol + hba1c + hsgrad + bmi3cat, data=v1)

table1(~ as.factor(stroke) + contacttype + age+ as.factor(htn) + as.factor(diab3cat) + as.factor(idealhealthsmk) + as.factor(bmi3cat)+ as.factor(totchol3cat) , data = data)
```

```{r, echo = FALSE, warning = FALSE, message = FALSE}

#Create time variable (time from visit 1 until event/censoring date)
data <- data %>% mutate(time = difftime(date, visitdate))

#Create the survival object (created from time variable and if the event has taken place.)
obj <- Surv(data$time, data$stroke)
```
