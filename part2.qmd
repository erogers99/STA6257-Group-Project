# Data Exploration 

```{r, echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)
library(haven)
library(table1)
library(lubridate)
library(survival)
library(ggsurvfit)
library(gtsummary)

#library(tidycmprsk)
#library(condSURV)
```


## Data Dictionary

Two data sets were utilized and joined to create a final data set for analysis. Following are the variables used.

### **DATA SET:** analysis1 {.unnumbered}

These data include observations from the participant's first visit in the study.

SUBJID

:   Subject identification number for participant

VISITDATE

:   Date of participant exam visit

AGE

:   Age (in years) of participant at time of visit 1
:   Age, based on birth date and clinic visit date, rounded to 0.1

HTN

:   Hypertension Status
:   HTN status is defined as blood pressure $\geq$ 140/90 mmHg (per JNC 7) or  use of blood pressure lowering medication.
:   0 = if BPjnc7 $\leq$ 1 (Normal/Pre-Hypertensive) AND participant NOT on medication
:   1 = if BPjnc7 $\geq$ 2 (Stage I/II Hypertension) AND participant uses medication to control hypertension

DIAB3CAT

:   Diabetes categorization

:   0 = Non-Diabetic

:   1 = Pre-Diabetic

:   2 = Diabetic

IDEALHEALTHSMK

:   Indicator for Ideal Health via Smoking Status

:   0 = Current smoker or Quit < 12 months ago

:   1 = Never smoked or Quit $\geq$ 12 months ago

BMI3CAT

:   0 = Poor Health defined as BMI $\geq$ 30 (Obese)

:   1 = Intermediate Health defined as 25 $\leq$ BMI < 30 (Overweight)

:   2 = Ideal Health defined as BMI < 25 (Normal)

TOTCHOL3CAT

:   AHA Total Cholesterol Categorization

:   0 = Poor Health defined as Total Cholesterol $\geq$ 240

:   1 = Intermediate Health defined as 200 $\leq$ Total Cholesterol < 240 OR if Total Cholesterol < 200 as controlled by medication

:   2 = Ideal Health defined as Total Cholesterol < 200 with NO medication use


### **DATA SET:** incevtstroke {.unnumbered}

SUBJID

:   Subject identification number for participant

STROKE
:   0 = No stroke
:   1 = Adjudication of Stroke

V1DATE

:   Date of Exam 1 Clinic Visit

DATE

:   Event (stroke) or Censoring Date

CONTACTTYPE

:   Last Contact Type (Censored, Hemorrhagic Stroke, Ischemic Stroke, Previous Stroke, Previous Stroke History, Refused)

## Summary statistics

```{r, echo = FALSE, warning = FALSE, message = FALSE}

#load visit 1 data
datav1 <- read_dta("data/analysis1.dta")
visit1 <- datav1 %>% dplyr :: select(subjid, visitdate, age, htn, diab3cat, idealhealthsmk, bmi3cat, totchol3cat)

#visit1 <- visit1 %>% rename(visitdate_v1 = visitdate)

#load adjudicated data

#data_allevtstroke <- read_sas("data/allevtstroke.sas7bdat", NULL)
#allevtstroke <- data_allevtstroke %>% dplyr :: select(subjid, Stroke, OHDStroke, eventdate)

data_incevtstroke <- read_sas("data/incevtstroke.sas7bdat", NULL)
incevtstroke <- data_incevtstroke %>% dplyr :: select(subjid, stroke, date, contactType)

#allevtstroke <- allevtstroke %>% rename(stroke_allevt = Stroke, ohdstroke = OHDStroke)

incevtstroke <- incevtstroke %>% rename(contacttype = contactType)

#data_adj <- full_join(allevtstroke, incevtstroke, by = "subjid")

# Create final data set

data <- full_join(incevtstroke, visit1, by = "subjid")
data <- na.omit(data)


#Transform data
data$stroke <- as.factor(data$stroke)
data$htn <- as.factor(data$htn)
data$diab3cat <- as.factor(data$diab3cat)
data$idealhealthsmk <- as.factor(data$idealhealthsmk)
data$totchol3cat <- as.factor(data$totchol3cat)
data$bmi3cat < as.factor(data$bm)

##Label data
label(data$stroke) <- "Adjudicated Stroke Occurrance"
levels(data$stroke) <- c("No Stroke", "Adjudicated Stroke")

label(data$htn) <- "Hypertensive Status"
levels(data$htn) <- c("Normal/Pre-Hypertensive", "Hypertensive")

label(data$diab3cat) <- "Diabetes Categorization"
levels(data$diab3cat) <- c("Non-Diabetic", "Pre-Diabetic", "Diabetic")

label(data$idealhealthsmk) <- "Smoking Status"
levels(data$idealhealthsmk) <- c("Current Smoker","Never Smoked/Quit + 12 months")

label(data$bmi3cat) <- "AHA BMI Categorization"
levels(data$bmi3cat) <- c("Obese","Overweight","Normal Weight")

label(data$totchol3cat) <- "AHA Total Cholesterol Categorization"
levels(data$totchol3cat) <- c("Poor Health","Intermediate Health","Ideal Health")

#Create Table
table1(~ stroke + contacttype + age + htn + diab3cat + idealhealthsmk + bmi3cat + totchol3cat, data = data)

```

```{r, echo = FALSE, warning = FALSE, message = FALSE}

#Create time variable (time from visit 1 until event/censoring date)
data <- data %>% mutate(time = difftime(date, visitdate))

#Create the survival object (created from time variable and if the event has taken place.)
obj <- Surv(data$time, data$stroke)
```
